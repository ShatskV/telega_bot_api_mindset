import requests
import settings

from requests.exceptions import (ConnectionError, HTTPError, Timeout)
def get_desc_and_tags(path, lang):
    api_route = '/api/demo/description/file'
    url = settings.url
    url = url + api_route
    files = {'image_file': open(path, 'rb')}
    data = {'lang': lang}
    try:
        response = requests.post(url, files=files, data=data, timeout=settings.ml_models_timeout)
        result = response.json()
    except  (ConnectionError, HTTPError, Timeout):
        return {'error': 'server unavailable'}
    answer = f"description: {result.get('description')}\ntags:\n"
    if result.get('tags'):
        for tag in result['tags']:
            if tag['confidence'] > 0.2:
                answer += f"{tag['tag']}: {tag['confidence']}\n" 
    else: 
        return {'error': 'server unavailable'}
